
<h1>Pin#index</h1>
<p>double click on map to add pin!</p>

<div class="row">
  <div class="col-lg-6">
    <div class="input-group">
      
      <input type="text" class="form-control">
    </div>
  </div>
</div>

<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>
<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>

<script type="text/javascript">
  
  $( document ).ready(function() {
     var raw_markers = <%=raw @hash.to_json %>;
});
  
  
  
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {mapTypeId:google.maps.MapTypeId.SATELLITE}, internal: {id: 'map'}}, 
                   function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %> );
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(5);
   google.maps.event.addListener(handler.getMap(), "dblclick", function(event){
          placeMarker(event.latLng);
        });
  function placeMarker(latLng) {
        var marker = new google.maps.Marker({
          position: latLng, 
          map: handler.getMap(),
          draggable: true
        });
    console.log("lat:" + latLng.lat() + "long:" + latLng.lng()) ;   
    
//     $.post({
//       data:  encodeURI({ latitude: latLng.lat(), longitude: latLng.lng()}),
//       url: "/pin/create",
//       type: 'post',
//       dataType: 'json',
      
//     });
    
      $.get ("/pins/new", 
      {
        latitude: latLng.lat(),
        longitude: latLng.lng()
      });
    
      //$.ajax({
      //  type: "POST",
      //  url: "/pin/create",
      //  data: { latitude: latLng.lat(), longitude: latLng.lng() },
        
        
    //});
        //markersArray.push(marker);
        // Set and open infowindow
        var infowindow = new google.maps.InfoWindow({
          content: 'latitude:' + latLng.lat() + '<br>longitude:' + latLng.lng()
        });
        infowindow.open(handler.getMap(), marker);
   }
    
                     
     
                     
                     
    
  });
</script>

<% content_for :scripts do %>
<script type= "text/javascript">
  
   Gmaps.map.callback = function() {
      google.maps.event.addListener(handler.getMap(), 'click', function(event) {
          
          placeMarker(event.latLng);
          
        });
   };
  
   function placeMarker(latLng) {
        var marker = new google.maps.Marker({
          position: latLng, 
          map: handler.getMap(),
          draggable: true
        });
        //markersArray.push(marker);
        // Set and open infowindow
        var infowindow = new google.maps.InfoWindow({
          content: 'hi'
        });
        infowindow.open(handler.getMap(), marker);
   }
</script>
<% end %>




  <body>
    <input id="pac-input" class="controls" type="text" placeholder="Search Box">
    <div id="map-canvas"></div>
  </body>

